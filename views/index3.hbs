
<script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIgHRdKzKEajo2T9uICvkdIHToQxgDfHg&libraries=places&calback=initMap&v=weekly">
            async
            
      </script>
<div class="col-md-6">
  <div class="card bg-dark text-light">
    <div class="card-header">
      <h1 class="h4 text-white">Lista de pedidos</h1>
    </div>
    <div class="card-body" style="/*color: black;*/">
      {{#if accordion}}
        <input id="accordion" type="hidden" value="{{accordion}}" />
        <div id="pedidos" ></div>
      {{!-- {{else}}
        <p class="fs-4 text-center">No hay pedidos registrados.</p> --}}
      {{/if}}
    </div>
    <div class="card-footer">
      <form action="{{#unless pedido.id}}/new-pedido{{else}}/update-pedido/{{pedido.id}}{{/unless}}" method="POST">
        <div class="row">
          <div class="col">
            <label for="repartidor">Repartidor:</label>
            <!---<input
              type="text"
              name="repartidor"
              placeholder="Ingrese numero de Repartidor"
              class="form-control mb-3"
              value="{{pedido.repartidor}}"
              autofocus
            />--->
            <select name="repartidor" id="repartidor"  class="form-control mb-3" autofocus placeholder="Elija numero de Repartidor" required>
              <option value="">-Ingrese numero de Repartidor-</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</op7tion>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="Andres">Andres</option>
              <option value="Direccion">Direccion</option>
            </select>
          </div>
          <div class="col">
            <label for="nomCliente">Cliente:</label>
            <input
              type="text"
              name="nomCliente"
              placeholder="Ingrese nombre del Cliente"
              class="form-control mb-3"
              value="{{pedido.nomCliente}}"
              autofocus
              required
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="org">Origen:</label>
            <input
              type="text"
              name="org"
              id="org"
              placeholder="Domicilio Origen"
              class="form-control mb-12"
              value="Lago Hielmar 96"
              required
            />
            <input id="orglat" name="orglat" type="hidden" value="" />
            <input id="orglong" name="orglong" type="hidden" value="" />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="dest">Destino:</label>
            <input
              type="dest"
              name="dest"
              id="dest"
              placeholder="Domicilio Destino"
              class="form-control mb-3"
              value="{{pedido.dest}}"
              required
            />
            <input id="destlat" name="destlat" type="hidden" value="" />
            <input id="destlong" name="destlong" type="hidden" value="" />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="phone_rep">Tel Repartidor:</label>
            <input
              type="tel"
              name="phone_rep"
              placeholder="5528296055"
              class="form-control mb-3"
              value="{{pedido.phone_rep}}"
            />
          </div>
          <div class="col">
            <label for="phone_cli">Tel Cliente:</label>
            <input
              type="tel"
              name="phone_cli"
              placeholder="5528296055"
              class="form-control mb-3"
              value="{{pedido.phone_cli}}"
            />
          </div>
        </div>
        {{#if pedido.id}}
          <!---<a
                  href="/edit-pedido/{{pedido.id}}"
                  class="btn btn-secondary"
                >Actualizar</a>
          <a href="/" class="btn btn-secondary">
            Cancel
          </a>--->
        {{else}}
          <button class="btn btn-primary btn-block">
            Agregar
          </button>
        {{/if}}
      </form>
    </div>
  </div>
</div>

<div class="col-md-6">
  <div class="jumbotron">
      <div class="container-fluid">
          <h4>Verifica Dirección</h4>
          <p></p>
          <form class="form-horizontal">
              <div class="form-group">
                  <label for="org" class="col-xs-2 control-label"><i class="far fa-dot-circle"></i></label>
                  <div class="col-xs-4"> 
                      <input type="text" id="org2" placeholder="Origin" class="form-control" value="Lago Hielmar 96">
                  </div>
             </div>
             <div class="form-group">
              
                  <label for="dest" class="col-xs-2 control-label"><i class="fas fa-map-marker-alt"></i></label>
                  <div class="col-xs-4">
                      <input type="text" id="dest2" placeholder="Destination" class="form-control">
                  </div>
               </div>
          </form>
          <div class="col-xs-offset-2 col-xs-10">
              <button class="btn btn-info btn-lg " onclick="calcRoute();"><i class="fas fa-map-signs"></i></button>
          </div>
      </div>
      <div class="container-fluid">
          <div id="googleMap">

          </div>
          <div id="output">

          </div>
      </div>
  </div>
</div>



      <script type="text/javascript">
      //javascript.js
      //set map options
      $(document).ready(function(){

        $("#pedidos").append($("#accordion").val());
        
      }).on("click" ,".imprimir", function(){

        var html = $(this).parents("li").html();//'<style media="all" type="text/css">';    
        /*html += 'body, html{margin:0; padding:0; line-height: 1.0em; z-index: 0;}';    
        html += 'H1{font-size: 9pt; font-family: arial; z-index: 0;}';    
        html += 'H2{font-size: 9pt; font-family: arial; font-style: italic; z-index: 0;}';    
        html += 'em{color: #000000;}';    
        html += '#watermark{position:absolute; z-index: -1; filter:alpha(opacity=15); -moz-opacity: 15%; opacity: 0.15; -khtml-                            opacity: 0.15; top: 0; left: 0; height: 100%; width: 100%;}';    
        html += '</style>';    
        html += '<div id="watermark"><img src="GenericLogo.jpg" width="100%" height="100%"></div>';    
        html += '<H1><em>The Home Page</em></H1>';    
        html += '<H2><em>';    
        html += '<ul STYLE="list-style-image: url(checkbox.gif)"><li>  Here is the first description line.</li></ul>';    
        html += '<ul STYLE="list-style-image: url(checkbox.gif)"><li>  Here is the second description line.</li></ul>';    
        html += '<ul STYLE="list-style-image: url(checkbox.gif)"><li>  Here is the third description line.</li></ul>';    
        html += '</em></H2>';    
        html += '<H2><em>Here is the summary line.</em></H2>';  */  
        // preview the output in the Javascript variable “html”,    
        // display a print dialog, then wait for the user to click    
        // the “Print” button.    
        var printWin = window.open("", "printSpecial");    
        printWin.document.open();    
        printWin.document.write(html);    
        printWin.document.close();    
        printWin.print(); 
        //console.log("Hola");

      });
      
      var myLatLng = { lat: 38.3460, lng: -0.4907 };
      var mapOptions = {
          center: myLatLng,
          zoom: 7,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          

      };

      //create map
      var map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);

      //create a DirectionsService object to use the route method and get a result for our request
      var directionsService = new google.maps.DirectionsService();

      //create a DirectionsRenderer object which we will use to display the route
      var directionsDisplay = new google.maps.DirectionsRenderer();

      //bind the DirectionsRenderer to the map
      directionsDisplay.setMap(map);


      //define calcRoute function
      function calcRoute() {
        var address1 = $("#org").val();
          fetch("https://maps.googleapis.com/maps/api/geocode/json?address="+address1+'&key=AIzaSyAIgHRdKzKEajo2T9uICvkdIHToQxgDfHg')
            .then(response => response.json())
            .then(data => {
              const latitude1 = data.results[0].geometry.location.lat;
              $("#orglat").val(latitude1.toString());
              const longitude1 = data.results[0].geometry.location.lng;
              $("#orglong").val(longitude1.toString());
              console.log({latitude1, longitude1})
            });
            var address2 = $("#dest").val();
            fetch("https://maps.googleapis.com/maps/api/geocode/json?address="+address2+'&key=AIzaSyAIgHRdKzKEajo2T9uICvkdIHToQxgDfHg')
            .then(response => response.json())
            .then(data => {
              const latitude2 = data.results[0].geometry.location.lat;
              $("#destlat").val(latitude2.toString());
              const longitude2 = data.results[0].geometry.location.lng;
              $("#destlong").val(longitude2.toString());
              console.log({latitude2, longitude2})
            });
          //create request
          var request = {
              origin: document.getElementById("org2").value,
              destination: document.getElementById("dest2").value,
              travelMode: google.maps.TravelMode.BICYCLING, //WALKING, BYCYCLING, TRANSIT
              unitSystem: google.maps.UnitSystem.IMPERIAL,
              avoidHighways: true,
            avoidTolls: true,
            optimizeWaypoints : true,
            provideRouteAlternatives: true,
            drivingOptions: {
              departureTime: new Date(/* now, or future date */),
              trafficModel: 'bestguess'
           },
          }

          //pass the request to the route method
          directionsService.route(request, function (result, status) {
              if (status == google.maps.DirectionsStatus.OK) {
                  var distance = result.routes[0].legs[0].distance.value; // meters
                  distance_KM = distance / 1000; // convert to kilometers

                  //Get distance and time
                  const output = document.querySelector('#output');
                  output.innerHTML = "<div class='alert-info'>From: " + document.getElementById("org").value + ".<br />To: " + document.getElementById("dest").value + ".<br /> Driving distance <i class='fas fa-road'></i> : " + distance_KM /*result.routes[0].legs[0].distance.text*/ + " km.<br />Duration <i class='fas fa-hourglass-start'></i> : " + result.routes[0].legs[0].duration.text + ".</div>";

                  //display route
                  directionsDisplay.setDirections(result);
              } else {
                  //delete route from map
                  directionsDisplay.setDirections({ routes: [] });
                  //center map in London
                  map.setCenter(myLatLng);

                  //show error message
                  output.innerHTML = "<div class='alert-danger'><i class='fas fa-exclamation-triangle'></i> Could not retrieve driving distance.</div>";
              }
          });

      }



      //create autocomplete objects for all inputs
      var options = {
          types: [/*'(cities)'*/],
          componentRestrictions: {country: "mx"}
      }

      var input1 = document.getElementById("org");
      var autocomplete1 = new google.maps.places.Autocomplete(input1, options);

      var input2 = document.getElementById("dest");
      var autocomplete2 = new google.maps.places.Autocomplete(input2, options);

      $(document).on('change', '#org', function(){
        /*$('#org2').change();
        $('#org2').val();*/

        autocomplete1.addListener('place_changed', function () {

          var place = autocomplete1.getPlace();

          // place variable will have all the information you are looking for.

          $('#org2').val(place.formatted_address);

          //$('#org2').val(place.geometry['location'].lng());

        });
      }).on('change', '#dest', function(){
        /*$('#dest2').change();
        $('#dest2').val();*/

        autocomplete2.addListener('place_changed', function () {

          var place = autocomplete2.getPlace();

          // place variable will have all the information you are looking for.
          console.log(place.formatted_address);
          $('#dest2').val(place.formatted_address);

          //$('#dest2').val(place.geometry['location'].lng());

        });

      });

    </script>